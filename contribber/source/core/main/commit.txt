Fixed bug causing unexpected behavior
Added error handling to prevent unexpected behavior
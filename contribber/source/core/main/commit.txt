Improved error handling for more robustness